<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../gold-email-input/gold-email-input.html">
<link rel="import" href="../paper-input/paper-input.html">
<!--
A form for creating a firebase authentication account and displaying input elements that are relevant to create the account.

Usage:

<material-create-user-form></material-create-user-form>

@demo demo/material-create-user-form.html
-->
<dom-module id="material-create-user-form">
    <template>
        <style>
        :host {
            display: block;
        }
        </style>

        <section id="password-provider">
            <p>Sign up with your e-mail address and password</p>
            <paper-input label="Name" value="{{displayName}}"></paper-input>

            <gold-email-input label="E-mail address" value="{{email}}" auto-validate invalid="{{_emailInvalid}}"></gold-email-input>
            <paper-input label="Password" value="{{password}}" type="password" auto-validate></paper-input>
            <paper-button on-tap="createUserWithPassword" disabled="{{!inputsValid}}">Create account</paper-button>
            <p hidden$="{{!errorMessage}}">
                {{errorMessage}}
            </p>
        </section>

    </template>
    <script>
    Polymer({
        is: 'material-create-user-form',

        properties: {
            /** E-mail address for new account **/
            email: {
                type: String,
                notify: true,
                value: ''
            },
            /** Display name for the new account **/
            displayName: {
                type: String,
                notify: true,
                value: ''
            },
            /** Password for new account **/
            password: {
                type: String,
                notify: true,
                value: ''
            },
            /** Both the e-mail and the password are filled in */
            inputsValid: {
                type: Boolean,
                computed: '_emailAndPasswordValid(email, displayName, _emailInvalid, password)',
                value: false
            },
            /** error m */
            errorMessage: {
                type: String,
                value: null,
                readOnly: true
            },

            _emailInvalid: Boolean,
        },
        
        /**
        * Non bubbling, to signal the need for a signUp.
        *
        * @event signUp
        */

        /**
        * Fire the `signUp` event
        */
        createUserWithPassword: function () {
            var email = this.email
            var password = this.password
            var displayName = this.displayName

            this._setErrorMessage(null)
            return this.fire('create-user', {
                email: email,
                password: password,
                displayName: displayName
            }, {
                bubbles: false
            })
        },

        /**
        * Set the error message to display
        */
        error: function (error) {
            console.log(error);
            if (error.code === "auth/email-already-in-use")
            return this._setErrorMessage('Email adress already in use')
            if (error.code === "auth/invalid-email") {
                return this._setErrorMessage('Invalid e-mail address')
            }
            return this._setErrorMessage('Error')
        },

        _emailAndPasswordValid: function (email, displayName, emailInvalid, password) {
            return (email !== '' && displayName !== '' && password !== '' && emailInvalid === false)
        },
    });
    </script>
</dom-module>
